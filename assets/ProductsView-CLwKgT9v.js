import{r as d,E as b,m as N,c as r,a as f,b as t,d as V,w as T,j as D,F as _,p as x,t as n,q as m,h as y,g as E,o as c,f as g,x as q,l as F,u as U}from"./index-ehUiTKS-.js";import{_ as O}from"./ToastNotification-Ck8PgkN6.js";import{S as $}from"./sweetalert2.esm.all-DvhyLlFx.js";const Q={class:"container-fluid"},R={class:"row mb-4"},G={class:"col"},J={class:"d-flex align-items-center justify-content-between"},K={class:"breadcrumb mb-0"},W={class:"breadcrumb-item"},X={class:"row"},Y={class:"col"},Z={class:"card"},tt={class:"p-4"},et={class:"justify-content-between row"},st={class:"col-lg-2 col-md-4 col-12"},lt=["value"],at={class:"card-body p-0"},ot={class:"table table-borderless align-middle table-hover"},nt={key:0,class:"productImg bg-light placeholder-glow"},it=["src","alt","onLoad"],rt={class:"dropdown"},ct={class:"dropdown-menu dropdown-menu-end py-0"},dt={class:"p-2 list-unstyled mb-0"},ut=["onClick"],vt=["onClick"],mt={class:"border-top d-md-flex justify-content-between align-items-center p-3"},gt={class:"pagination mb-0"},pt=["onClick"],xt={__name:"ProductsView",setup(ht){const p=d(null),B=U(),k=d([]),l=d({}),C=d([]),u=d(""),h=d(""),P=d({}),v=async(a=1,e=10,i="",s="")=>{try{const{data:o}=await y.get("undefined/products/all",{params:{page:a,limit:e,category:i,status:s}});o!=null&&o.data?(k.value=o.data.products||[],l.value=o.data.pagination||l.value):console.warn("無效的 API 回應結構",o)}catch(o){console.error("API 請求失敗:",o)}},M=a=>{P.value[a]=!0},I=a=>{B.push(`/admin/product/${a}`)},L=async(a,e)=>{try{if((await $.fire({title:"刪除產品",text:`確定要刪除${e}嗎`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#198754",cancelButtonColor:"#b6b6b6",confirmButtonText:"確定",cancelButtonText:"取消"})).isConfirmed){const o=(await y.delete(`undefined/products/product/${a}`)).data.message||"產品刪除成功！";p.value.showSuccessToast(o),await $.fire({title:"成功!",text:`刪除${e}成功`,icon:"success"}),await v(l.value.currentPage,l.value.limit,u.value,h.value)}}catch(i){console.error("API 請求失敗:",i),p.value.showErrorToast(i)}},A=b(()=>Math.max((l.value.currentPage-1)*l.value.limit+1,0)),z=b(()=>Math.min(l.value.currentPage*l.value.limit,l.value.totalItems)),j=b(()=>Array.from({length:l.value.totalPages},(a,e)=>e+1)),w=async a=>{a<1||a>l.value.totalPages||a!==l.value.currentPage&&(l.value.currentPage=a,await v(a,l.value.limit,u.value,h.value))},S=async()=>{try{const{data:a}=await y.get("undefined/categories/all");C.value=Object.values(a.data)}catch(a){console.error("API 請求失敗:",a)}},H=async()=>{await v(1,l.value.limit,u.value,h.value)};return N(async()=>{try{await v(),await S()}catch(a){console.error(a.message)}}),(a,e)=>{const i=E("router-link");return c(),r("div",Q,[f(O,{ref_key:"toast",ref:p},null,512),t("div",R,[t("div",G,[t("div",J,[t("div",null,[e[5]||(e[5]=t("h2",null,"產品",-1)),t("nav",null,[t("ol",K,[t("li",W,[f(i,{to:"/admin/dashboard"},{default:V(()=>e[3]||(e[3]=[g("首頁")])),_:1})]),e[4]||(e[4]=t("li",{class:"breadcrumb-item active","aria-current":"page"},"產品",-1))])])]),f(i,{to:"/admin/product",class:"btn btn-primary"},{default:V(()=>e[6]||(e[6]=[g(" 新增產品 ")])),_:1})])])]),t("div",X,[t("div",Y,[t("div",Z,[t("div",tt,[t("div",et,[e[8]||(e[8]=t("div",{class:"mb-2 mb-lg-0 col-lg-4 col-md-6 col-12"},[t("form",{class:"d-flex"},[t("input",{placeholder:"搜尋產品",class:"form-control",type:"search"})])],-1)),t("div",st,[T(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),onChange:H},[e[7]||(e[7]=t("option",{value:""},"所有類別",-1)),(c(!0),r(_,null,x(C.value,s=>(c(),r("option",{key:s.id,value:s.name},n(s.name),9,lt))),128))],544),[[D,u.value]])])])]),t("div",at,[t("table",ot,[e[14]||(e[14]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{colspan:"1"},[t("input",{class:"form-check-input",type:"checkbox"})]),t("th",{colspan:"1"},"圖片"),t("th",{colspan:"1"},"產品名稱"),t("th",{colspan:"1"},"類別"),t("th",{colspan:"1"},"狀態"),t("th",{colspan:"1"},"價格"),t("th",{colspan:"1"},"上架日期"),t("th",{colspan:"1"})])],-1)),t("tbody",null,[(c(!0),r(_,null,x(k.value,s=>(c(),r("tr",{key:s.id},[e[13]||(e[13]=t("td",{colspan:"1"},[t("input",{class:"form-check-input",type:"checkbox"})],-1)),t("td",null,[P.value[s.id]?q("",!0):(c(),r("div",nt,e[9]||(e[9]=[t("span",{class:"placeholder w-100 h-100"},null,-1)]))),t("img",{class:"productImg",src:s.imageUrl,alt:s.title,onLoad:o=>M(s.id)},null,40,it)]),t("td",null,n(s.title),1),t("td",null,n(s.category),1),t("td",null,[t("span",{class:m(["badge",[s.is_enabled?"bg-success":"bg-secondary"]])},n(s.is_enabled?"已上架":"未上架"),3)]),t("td",null,n(s.price),1),t("td",null,n(s.createdAt),1),t("td",null,[t("div",rt,[e[12]||(e[12]=F('<button class="text-reset btn p-0 border-0" data-bs-toggle="dropdown" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fs-5"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg></button>',1)),t("div",ct,[t("ul",dt,[t("li",null,[t("button",{type:"button",onClick:o=>I(s.id),class:"dropdown-item px-1 d-flex align-items-center btn"},e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square me-2",viewBox:"0 0 16 16"},[t("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),t("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1),g(" 編輯 ")]),8,ut)]),t("li",null,[t("button",{type:"button",onClick:o=>L(s.id,s.title),class:"dropdown-item px-1 d-flex align-items-center btn"},e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-trash me-2",viewBox:"0 0 16 16"},[t("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),t("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1),g(" 刪除 ")]),8,vt)])])])])])]))),128))])])])])])]),t("div",mt,[t("div",null," 顯示 "+n(A.value)+" - "+n(z.value)+" 共 "+n(l.value.totalItems)+" 筆 ",1),t("nav",null,[t("ul",gt,[t("li",{class:m(["page-item",{disabled:l.value.currentPage===1}])},[t("button",{class:"page-link",onClick:e[1]||(e[1]=s=>w(l.value.currentPage-1))},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-chevron-left",viewBox:"0 0 16 16"},[t("path",{"fill-rule":"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"})],-1)]))],2),(c(!0),r(_,null,x(j.value,s=>(c(),r("li",{key:s,class:m(["page-item",{active:s===l.value.currentPage}])},[t("button",{class:"page-link",onClick:o=>w(s)},n(s),9,pt)],2))),128)),t("li",{class:m(["page-item",{disabled:l.value.currentPage===l.value.totalPages}])},[t("button",{class:"page-link",onClick:e[2]||(e[2]=s=>w(l.value.currentPage+1))},e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-chevron-right",viewBox:"0 0 16 16"},[t("path",{"fill-rule":"evenodd",d:"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"})],-1)]))],2)])])])])}}};export{xt as default};
