import{r as d,n as F,c as u,d as B,a as s,e as q,F as S,q as T,b as I,t as v,w as h,v as j,j as E,M as m,h as c,g as A,o as b,s as V}from"./index-CjAU--pw.js";import{_ as P}from"./ToastNotification-J1GOZ7GQ.js";import{S as _}from"./sweetalert2.esm.all-DvhyLlFx.js";const G={class:"container-fluid"},H={class:"row mb-4"},J={class:"col"},K={class:"d-flex align-items-center justify-content-between"},Q={class:"breadcrumb mb-0"},W={class:"breadcrumb-item"},X={class:"row"},Y={class:"col-6"},Z={class:"card"},ss={class:"p-4"},es={class:"justify-content-between d-flex"},ts={class:"card-body p-0"},os={class:"table table-borderless align-middle table-hover"},as={colspan:"1",class:"text-end"},ls=["onClick"],ns=["onClick"],is=["onClick"],ds={class:"col-6"},cs={class:"card"},rs={class:"p-4"},us={class:"justify-content-between d-flex"},bs=["disabled"],vs={class:"card-body p-0"},ms={key:0,class:"text-center p-3"},ps={key:1,class:"table-responsive"},gs={class:"table table-borderless align-middle table-hover"},ys={colspan:"1",class:"text-end"},fs=["onClick"],hs=["onClick"],_s={class:"modal-dialog modal-dialog-centered"},ws={class:"modal-content"},Cs={class:"modal-header"},xs={class:"modal-title"},ks={class:"modal-body"},Ms={class:"row"},$s={class:"mb-4 col-12"},Bs={class:"mb-4 col-12"},Ss={class:"modal-footer"},Ts={class:"modal-dialog modal-dialog-centered"},Is={class:"modal-content"},js={class:"modal-header"},Es={class:"modal-title"},Vs={class:"modal-body"},Ds={class:"row"},Rs={class:"mb-4 col-12"},Us={class:"mb-4 col-12"},Ls={class:"modal-footer"},qs={__name:"CategoriesView",setup(Ns){const i="https://mumuapi.zeabur.app/api",n=d(null),w=d([]),a=d({name:"",is_enabled:"",subcategories:""}),C=d(null),p=d(null),g=d([]),l=d({name:"",is_enabled:""}),x=d(null),k=t=>{a.value={...t},new m(C.value).show()},D=()=>{const t=document.getElementById("categoryModal");t&&(m.getInstance(t)||new m(t)).hide()},y=async()=>{const{data:t}=await c.get(`${i}/categories/all`);w.value=Object.values(t.data)},R=async()=>{try{if(a.value.id){const e=(await c.put(`${i}/categories/${a.value.id}`,a.value)).data.message||"類別已成功更新";n.value.showSuccessToast(e)}else{const e=(await c.post(`${i}/categories/category`,a.value)).data.message||"類別已成功儲存";n.value.showSuccessToast(e)}await y(),D()}catch(t){console.error("儲存類別失敗:",t)}},U=async t=>{try{if((await _.fire({title:"刪除主類",text:"確定要刪除主類別嗎",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"})).isConfirmed){const o=(await c.delete(`${i}/categories/${t}`)).data.message||"類別已成功刪除";n.value.showSuccessToast(o),await _.fire({title:"成功!",text:"刪除主類別成功",icon:"success"}),await y()}}catch(e){console.error("刪除類別失敗:",e),n.value.showErrorToast("刪除類別失敗，請稍後再試")}},M=t=>{l.value={...t},new m(x.value).show()},L=()=>{const t=document.getElementById("subCategoryModal");t&&(m.getInstance(t)||new m(t)).hide()},$=async t=>{try{const{data:e}=await c.get(`${i}/categories/${t}/subcategories`);g.value=Object.values(e.data)}catch(e){console.error("取得子類別資料失敗:",e)}},N=t=>{try{g.value=Object.values(t.subcategories),p.value=t.id}catch(e){console.error("開啟子類別失敗:",e)}},O=async()=>{try{const t=p.value;if(l.value.categoryId){const r=(await c.put(`${i}/categories/${t}/subcategories`,l.value)).data.message||"子類別已成功更新";n.value.showSuccessToast(r)}else{const r=(await c.post(`${i}/categories/${t}/subcategories`,l.value)).data.message||"子類別已成功儲存";n.value.showSuccessToast(r)}l.value={},await y(),await $(t),L()}catch(t){console.error("儲存類別失敗:",t)}},z=async t=>{try{if((await _.fire({title:"刪除主類",text:"確定要刪除子類別嗎",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"})).isConfirmed){const o=(await c.delete(`${i}/categories/${p.value}/subcategories/${t}`)).data.message||"子類別已成功刪除";n.value.showSuccessToast(o),await _.fire({title:"成功!",text:"刪除子類別成功",icon:"success"}),await $(p.value),g.value.length===0&&n.value.showInfoToast("目前沒有子類別資料")}}catch(e){console.error("刪除子類別失敗:",e)}};return F(async()=>{try{await y()}catch(t){console.error("API 請求失敗:",t)}}),(t,e)=>{const r=A("router-link");return b(),u("div",G,[B(P,{ref_key:"toast",ref:n},null,512),s("div",H,[s("div",J,[s("div",K,[s("div",null,[e[10]||(e[10]=s("h2",null,"類別",-1)),s("nav",null,[s("ol",Q,[s("li",W,[B(r,{to:"/admin/dashboard"},{default:q(()=>e[8]||(e[8]=[I("首頁")])),_:1})]),e[9]||(e[9]=s("li",{class:"breadcrumb-item active"},"類別",-1))])])])])])]),s("div",X,[s("div",Y,[s("div",Z,[s("div",ss,[s("div",es,[e[11]||(e[11]=s("select",{class:"form-select w-auto"},[s("option",{value:""},"狀態"),s("option",{value:"published"},"已上架"),s("option",{value:"unpublished"},"未上架")],-1)),s("button",{onClick:e[0]||(e[0]=o=>k({})),type:"button",class:"btn btn-primary"},"新增分類")])]),s("div",ts,[s("table",os,[e[13]||(e[13]=s("thead",{class:"table-light"},[s("tr",null,[s("th",{colspan:"1"},[s("input",{class:"form-check-input",type:"checkbox"})]),s("th",{colspan:"1"},"名稱"),s("th",{colspan:"1"},"狀態"),s("th",{colspan:"1"})])],-1)),s("tbody",null,[(b(!0),u(S,null,T(w.value,o=>(b(),u("tr",{key:o.id},[e[12]||(e[12]=s("td",{colspan:"1"},[s("input",{class:"form-check-input",type:"checkbox"})],-1)),s("td",null,v(o.name),1),s("td",null,[s("span",{class:V(["badge",[o.is_enabled?"bg-success":"bg-secondary"]])},v(o.is_enabled?"已上架":"未上架"),3)]),s("td",as,[s("button",{onClick:f=>k(o),class:"btn text-primary"},"編輯",8,ls),s("button",{onClick:f=>U(o.id),class:"btn text-danger"},"刪除",8,ns),s("button",{onClick:f=>N(o),class:"btn text-secondary"},"子選單",8,is)])]))),128))])]),e[14]||(e[14]=s("div",{class:"border-top d-md-flex justify-content-between align-items-center p-3"},[s("div",null,"顯示1到 10 個項目 （共14 個項目）"),s("nav",{class:"mt-2 mt-md-0 navbar navbar-expand"},[s("ul",{class:"mb-0 pagination"},[s("li",{class:"page-item mx-1 disabled"},[s("span",{class:"page-link"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-chevron-left",viewBox:"0 0 16 16"},[s("path",{"fill-rule":"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"})])])]),s("li",{class:"page-item mx-1 active"},[s("span",{class:"page-link rounded-1"},[I("1"),s("span",{class:"visually-hidden"},"(current)")])]),s("li",{class:"page-item mx-1"},[s("a",{class:"page-link rounded-1",role:"button",tabindex:"0",href:"#"},"2")]),s("li",{class:"page-item mx-1"},[s("a",{class:"page-link",role:"button",tabindex:"0",href:"#"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-chevron-right",viewBox:"0 0 16 16"},[s("path",{"fill-rule":"evenodd",d:"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"})])])])])])],-1))])])]),s("div",ds,[s("div",cs,[s("div",rs,[s("div",us,[e[15]||(e[15]=s("select",{class:"form-select w-auto"},[s("option",{value:""},"狀態"),s("option",{value:"published"},"已上架"),s("option",{value:"unpublished"},"未上架")],-1)),s("button",{onClick:e[1]||(e[1]=o=>M({})),type:"button",class:"btn btn-primary",disabled:!p.value},"新增子選單",8,bs)])]),s("div",vs,[g.value.length===0?(b(),u("div",ms,e[16]||(e[16]=[s("p",{class:"text-muted"},"尚無子類別資料",-1)]))):(b(),u("div",ps,[s("table",gs,[e[18]||(e[18]=s("thead",{class:"table-light"},[s("tr",null,[s("th",{colspan:"1"},[s("input",{class:"form-check-input",type:"checkbox"})]),s("th",{colspan:"1"},"名稱"),s("th",{colspan:"1"},"狀態"),s("th",{colspan:"1"})])],-1)),s("tbody",null,[(b(!0),u(S,null,T(g.value,o=>(b(),u("tr",{key:o.id},[e[17]||(e[17]=s("td",{colspan:"1"},[s("input",{class:"form-check-input",type:"checkbox"})],-1)),s("td",null,v(o.name),1),s("td",null,[s("span",{class:V(["badge",[o.is_enabled?"bg-success":"bg-secondary"]])},v(o.is_enabled?"已上架":"未上架"),3)]),s("td",ys,[s("button",{onClick:f=>M(o),type:"button",class:"btn text-primary"},"編輯",8,fs),s("button",{onClick:f=>z(o.id),type:"button",class:"btn text-danger"},"刪除",8,hs)])]))),128))])])]))])])])]),s("div",{class:"modal fade",id:"categoryModal",ref_key:"categoryModalRef",ref:C},[s("div",_s,[s("div",ws,[s("div",Cs,[s("h5",xs,v(a.value.id?"編輯主類別":"新增主類別"),1),e[19]||(e[19]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),s("div",ks,[s("div",Ms,[s("div",$s,[e[20]||(e[20]=s("label",{class:"form-label"},"類別名稱",-1)),h(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.name=o),class:"form-control",type:"text"},null,512),[[j,a.value.name]])]),s("div",Bs,[e[22]||(e[22]=s("label",{class:"form-label"},"狀態",-1)),h(s("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=o=>a.value.is_enabled=o)},e[21]||(e[21]=[s("option",{value:1},"上架",-1),s("option",{value:0},"下架",-1)]),512),[[E,a.value.is_enabled]])])])]),s("div",Ss,[s("button",{onClick:e[4]||(e[4]=o=>R(a.value.id)),type:"button",class:"btn btn-primary"},"儲存")])])])],512),s("div",{class:"modal fade",id:"subCategoryModal",ref_key:"subCategoryModalRef",ref:x},[s("div",Ts,[s("div",Is,[s("div",js,[s("h5",Es,v(l.value.categoryId?"編輯子類別":"新增子類別"),1),e[23]||(e[23]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),s("div",Vs,[s("div",Ds,[s("div",Rs,[e[24]||(e[24]=s("label",{class:"form-label"},"名稱",-1)),h(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.name=o),class:"form-control",type:"text"},null,512),[[j,l.value.name]])]),s("div",Us,[e[26]||(e[26]=s("label",{class:"form-label"},"狀態",-1)),h(s("select",{class:"form-select","onUpdate:modelValue":e[6]||(e[6]=o=>l.value.is_enabled=o)},e[25]||(e[25]=[s("option",{value:1},"上架",-1),s("option",{value:0},"下架",-1)]),512),[[E,l.value.is_enabled]])])])]),s("div",Ls,[s("button",{onClick:e[7]||(e[7]=o=>O()),type:"button",class:"btn btn-primary"},"儲存")])])])],512)])}}};export{qs as default};
